2024-12-07 15:37:17,434 - __main__ - ERROR - Error in main function: ADMIN_USER_ID must be a valid integer
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/core/config.py", line 63, in load_config
    admin_user_id = int(os.getenv('ADMIN_USER_ID'))
ValueError: invalid literal for int() with base 10: 'your_admin_telegram_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/main.py", line 34, in main
    config = load_config()
  File "/Users/kagitin/CascadeProjects/priceguard/src/core/config.py", line 65, in load_config
    raise ValueError("ADMIN_USER_ID must be a valid integer")
ValueError: ADMIN_USER_ID must be a valid integer
2024-12-07 15:41:33,320 - __main__ - ERROR - Error in main function: ADMIN_USER_ID must be a valid integer
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/core/config.py", line 63, in load_config
    admin_user_id = int(os.getenv('ADMIN_USER_ID'))
ValueError: invalid literal for int() with base 10: 'your_admin_telegram_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/main.py", line 34, in main
    config = load_config()
  File "/Users/kagitin/CascadeProjects/priceguard/src/core/config.py", line 65, in load_config
    raise ValueError("ADMIN_USER_ID must be a valid integer")
ValueError: ADMIN_USER_ID must be a valid integer
2024-12-07 15:42:12,248 - __main__ - ERROR - Error in main function: ADMIN_USER_ID must be a valid integer
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/core/config.py", line 63, in load_config
    admin_user_id = int(os.getenv('ADMIN_USER_ID'))
ValueError: invalid literal for int() with base 10: 'your_admin_telegram_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/main.py", line 34, in main
    config = load_config()
  File "/Users/kagitin/CascadeProjects/priceguard/src/core/config.py", line 65, in load_config
    raise ValueError("ADMIN_USER_ID must be a valid integer")
ValueError: ADMIN_USER_ID must be a valid integer
2024-12-07 15:45:02,822 - __main__ - ERROR - Error in main function: ADMIN_USER_ID must be a valid integer
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/core/config.py", line 63, in load_config
    admin_user_id = int(os.getenv('ADMIN_USER_ID'))
ValueError: invalid literal for int() with base 10: 'your_admin_telegram_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/main.py", line 34, in main
    config = load_config()
  File "/Users/kagitin/CascadeProjects/priceguard/src/core/config.py", line 65, in load_config
    raise ValueError("ADMIN_USER_ID must be a valid integer")
ValueError: ADMIN_USER_ID must be a valid integer
2024-12-07 15:47:20,173 - __main__ - ERROR - Error in main function: ADMIN_USER_ID must be a valid integer
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/core/config.py", line 63, in load_config
    admin_user_id = int(os.getenv('ADMIN_USER_ID'))
ValueError: invalid literal for int() with base 10: 'your_admin_telegram_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/main.py", line 34, in main
    config = load_config()
  File "/Users/kagitin/CascadeProjects/priceguard/src/core/config.py", line 65, in load_config
    raise ValueError("ADMIN_USER_ID must be a valid integer")
ValueError: ADMIN_USER_ID must be a valid integer
2024-12-07 15:49:21,446 - __main__ - ERROR - Error in main function: ADMIN_USER_ID must be a valid integer
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/core/config.py", line 63, in load_config
    admin_user_id = int(os.getenv('ADMIN_USER_ID'))
ValueError: invalid literal for int() with base 10: 'your_admin_telegram_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/main.py", line 34, in main
    config = load_config()
  File "/Users/kagitin/CascadeProjects/priceguard/src/core/config.py", line 65, in load_config
    raise ValueError("ADMIN_USER_ID must be a valid integer")
ValueError: ADMIN_USER_ID must be a valid integer
2024-12-07 15:50:58,481 - __main__ - ERROR - Error in main function: ADMIN_USER_ID must be a valid integer
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/core/config.py", line 68, in load_config
    admin_user_id = int(os.getenv('ADMIN_USER_ID'))
ValueError: invalid literal for int() with base 10: 'your_admin_telegram_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/main.py", line 34, in main
    config = load_config()
  File "/Users/kagitin/CascadeProjects/priceguard/src/core/config.py", line 71, in load_config
    raise ValueError("ADMIN_USER_ID must be a valid integer")
ValueError: ADMIN_USER_ID must be a valid integer
2024-12-07 15:52:01,220 - __main__ - ERROR - Error in main function: ADMIN_USER_ID must be a valid integer
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/core/config.py", line 68, in load_config
    admin_user_id = int(os.getenv('ADMIN_USER_ID'))
ValueError: invalid literal for int() with base 10: 'your_admin_telegram_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/main.py", line 34, in main
    config = load_config()
  File "/Users/kagitin/CascadeProjects/priceguard/src/core/config.py", line 71, in load_config
    raise ValueError("ADMIN_USER_ID must be a valid integer")
ValueError: ADMIN_USER_ID must be a valid integer
2024-12-07 15:53:14,043 - __main__ - ERROR - Error in main function: Passing `parse_mode`, `disable_web_page_preview` or `protect_content` to Bot initializer is not supported anymore. These arguments have been removed in 3.7.0 version. Use `default=DefaultBotProperties(parse_mode='HTML')` argument instead.
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/main.py", line 38, in main
    bot = Bot(token=config.telegram.token, parse_mode="HTML")
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/client/bot.py", line 310, in __init__
    raise TypeError(
    ...<3 lines>...
    )
TypeError: Passing `parse_mode`, `disable_web_page_preview` or `protect_content` to Bot initializer is not supported anymore. These arguments have been removed in 3.7.0 version. Use `default=DefaultBotProperties(parse_mode='HTML')` argument instead.
2024-12-07 16:08:44,211 - __main__ - ERROR - Error in main function: object Database can't be used in 'await' expression
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/main.py", line 43, in main
    db = await Database(config.database.path)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: object Database can't be used in 'await' expression
2024-12-07 16:09:47,971 - __main__ - ERROR - Error in main function: 'Config' object has no attribute 'encryption'
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/main.py", line 46, in main
    marketplace_factory = MarketplaceFactory(encryption_key=config.encryption.key)
                                                            ^^^^^^^^^^^^^^^^^
AttributeError: 'Config' object has no attribute 'encryption'. Did you mean: 'encryption_key'?
2024-12-07 16:10:35,036 - __main__ - ERROR - Error in main function: Fernet key must be 32 url-safe base64-encoded bytes.
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/cryptography/fernet.py", line 34, in __init__
    key = base64.urlsafe_b64decode(key)
  File "/usr/local/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/base64.py", line 134, in urlsafe_b64decode
    return b64decode(s)
  File "/usr/local/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/base64.py", line 88, in b64decode
    return binascii.a2b_base64(s, strict_mode=validate)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^
binascii.Error: Incorrect padding

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/main.py", line 46, in main
    marketplace_factory = MarketplaceFactory(encryption_key=config.encryption_key)
  File "/Users/kagitin/CascadeProjects/priceguard/src/services/marketplaces/factory.py", line 22, in __init__
    self.fernet = Fernet(encryption_key.encode())
                  ~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/cryptography/fernet.py", line 36, in __init__
    raise ValueError(
        "Fernet key must be 32 url-safe base64-encoded bytes."
    ) from exc
ValueError: Fernet key must be 32 url-safe base64-encoded bytes.
2024-12-07 16:11:49,088 - __main__ - ERROR - Error in main function: NotificationService.__init__() got an unexpected keyword argument 'database'
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/main.py", line 49, in main
    notification_service = NotificationService(bot=bot, database=db)
TypeError: NotificationService.__init__() got an unexpected keyword argument 'database'
2024-12-07 16:12:53,190 - __main__ - ERROR - Error in main function: PromotionMonitor.__init__() got an unexpected keyword argument 'database'
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/main.py", line 52, in main
    monitor = PromotionMonitor(
        database=db,
        notification_service=notification_service,
        client_factory=marketplace_factory
    )
TypeError: PromotionMonitor.__init__() got an unexpected keyword argument 'database'
2024-12-07 16:13:45,166 - __main__ - ERROR - Error in main function: 'Database' object has no attribute 'telegram'
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/main.py", line 58, in main
    setup_middlewares(dp, db)
    ~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/middlewares/__init__.py", line 20, in setup_middlewares
    dp.message.middleware(AuthMiddleware(config.telegram.admin_user_id))
                                         ^^^^^^^^^^^^^^^
AttributeError: 'Database' object has no attribute 'telegram'
2024-12-07 16:14:34,918 - __main__ - ERROR - Error in main function: register_all_handlers() missing 2 required positional arguments: 'config' and 'db'
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/main.py", line 66, in main
    register_all_handlers(dp)
    ~~~~~~~~~~~~~~~~~~~~~^^^^
TypeError: register_all_handlers() missing 2 required positional arguments: 'config' and 'db'
2024-12-07 16:15:22,698 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 16:16:35,311 - aiogram.event - ERROR - Cause exception while process update id=20180897 by bot id=7683347152
RuntimeError: Database not initialized
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/middlewares/auth.py", line 38, in __call__
    user_data = await db.get_user(user.id)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/src/core/database.py", line 149, in get_user
    raise RuntimeError("Database not initialized")
RuntimeError: Database not initialized
2024-12-07 16:17:35,370 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 16:18:10,441 - bot.middlewares.error - ERROR - Error processing event from user 743731: cmd_admin() missing 1 required positional argument: 'settings'
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/middlewares/error.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 ~~~~~~~^^
TypeError: cmd_admin() missing 1 required positional argument: 'settings'
2024-12-07 16:21:21,252 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 16:21:35,583 - bot.middlewares.error - ERROR - Error processing event from user 743731: cmd_admin() missing 1 required positional argument: 'settings'
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/middlewares/error.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 ~~~~~~~^^
TypeError: cmd_admin() missing 1 required positional argument: 'settings'
2024-12-07 16:22:41,650 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 16:22:54,829 - bot.middlewares.error - ERROR - Error processing event from user 743731: 'Config' object has no attribute 'admin_user_id'
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/middlewares/error.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/handlers/admin.py", line 37, in cmd_admin
    if not await is_admin(message.from_user.id, settings):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/handlers/admin.py", line 32, in is_admin
    return str(user_id) == settings.admin_user_id
                           ^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Config' object has no attribute 'admin_user_id'
2024-12-07 16:23:44,639 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 16:25:25,169 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 17:00:06,566 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 17:00:57,032 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 17:03:07,081 - bot.middlewares.error - ERROR - Error processing event from user 1879978399: process_ozon_api_key() missing 1 required positional argument: 'marketplace_factory'
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/middlewares/error.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 ~~~~~~~^^
TypeError: process_ozon_api_key() missing 1 required positional argument: 'marketplace_factory'
2024-12-07 17:05:09,802 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 17:17:24,662 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 17:17:42,353 - bot.middlewares.error - ERROR - Error processing event from user 743731: 'Database' object has no attribute 'get_all_users'
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/middlewares/error.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/handlers/admin.py", line 198, in on_admin_users
    users = await db.get_all_users()
                  ^^^^^^^^^^^^^^^^
AttributeError: 'Database' object has no attribute 'get_all_users'
2024-12-07 17:19:02,319 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 17:19:21,720 - bot.middlewares.error - ERROR - Error processing event from user 743731: fromisoformat: argument must be str
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/middlewares/error.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/handlers/admin.py", line 208, in on_admin_users
    text += format_user_info(user) + "\n"
            ~~~~~~~~~~~~~~~~^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/utils/messages.py", line 142, in format_user_info
    end_date = datetime.fromisoformat(end_date).strftime("%d.%m.%Y")
               ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^
TypeError: fromisoformat: argument must be str
2024-12-07 17:21:13,163 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 17:28:57,390 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 17:30:08,026 - services.marketplaces.factory - ERROR - Error creating ozon client: 
2024-12-07 17:35:13,035 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 17:35:33,963 - services.marketplaces.base - ERROR - Connection error: 404, message='Attempt to decode JSON with unexpected mimetype: text/plain; charset=utf-8', url='https://api-seller.ozon.ru/v1/product/info/list'
2024-12-07 17:35:33,964 - services.marketplaces.factory - ERROR - Error creating ozon client: Invalid ozon API key
2024-12-07 21:37:10,216 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 21:37:50,088 - services.marketplaces.factory - ERROR - Error decrypting API key: 
2024-12-07 21:37:50,088 - services.marketplaces.factory - ERROR - Error creating ozon client: 
2024-12-07 21:39:09,888 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 21:39:32,491 - services.marketplaces.base - ERROR - Unexpected response type: text/plain; charset=utf-8, body: 404 page not found

2024-12-07 21:39:32,491 - services.marketplaces.base - ERROR - Validation error: Invalid API key or Client ID
2024-12-07 21:41:20,544 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 21:41:40,813 - services.marketplaces.base - ERROR - Unexpected response type: text/plain; charset=utf-8, body: 404 page not found

2024-12-07 21:41:40,813 - services.marketplaces.base - ERROR - Validation error: Invalid API key or Client ID
2024-12-07 21:42:20,142 - services.marketplaces.factory - ERROR - Error decrypting API key: 
2024-12-07 21:42:20,142 - services.marketplaces.factory - ERROR - Error creating wildberries client: 
2024-12-07 21:44:24,794 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 21:44:47,775 - services.marketplaces.base - ERROR - Unexpected response type: text/plain; charset=utf-8, body: 404 page not found

2024-12-07 21:44:47,775 - services.marketplaces.base - ERROR - Validation error: Invalid API key or Client ID
2024-12-07 21:45:08,443 - services.marketplaces.base - ERROR - Unexpected response type: text/html; charset=utf-8, body: <html>
<head><title>404 Not Found</title></head>
<body>
<center><h1>404 Not Found</h1></center>
<hr><center>nginx</center>
</body>
</html>

2024-12-07 21:45:08,443 - services.marketplaces.base - ERROR - Validation error: Invalid API key or Client ID
2024-12-07 21:45:08,443 - bot.middlewares.error - ERROR - Error processing event from user 1879978399: name 'logger' is not defined
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/handlers/user.py", line 212, in process_wb_api_key
    is_valid = await client.validate_api_key()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/src/services/marketplaces/wildberries.py", line 34, in validate_api_key
    await self._make_request(
    ...<3 lines>...
    )
  File "/Users/kagitin/CascadeProjects/priceguard/src/services/marketplaces/base.py", line 77, in _make_request
    raise ValueError("Invalid API key or Client ID")
ValueError: Invalid API key or Client ID

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/middlewares/error.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/handlers/user.py", line 240, in process_wb_api_key
    logger.error(f"Error processing Wildberries API key: {str(e)}")
    ^^^^^^
NameError: name 'logger' is not defined
2024-12-07 21:49:35,882 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 21:49:59,210 - services.marketplaces.base - ERROR - Unexpected response type: application/problem+json, body: {
    "title": "path not found",
    "detail": "Please consult the https://openapi.wildberries.ru",
    "code": "9995b4770d66c-f3e1c2a5 afe5729a7d2c3880a9d26a24a4224b81",
    "requestId": "afe5729a7d2c3880a9d26a24a4224b81",
    "origin": "s2s-api-auth-dp-sandbox",
    "status": 404,
    "statusText": "Not Found",
    "timestamp": "2024-12-07T18:49:58Z"
}

2024-12-07 21:49:59,210 - services.marketplaces.base - ERROR - Validation error: Invalid API key or Client ID
2024-12-07 21:49:59,211 - bot.handlers.user - ERROR - Error processing Wildberries API key: Invalid API key or Client ID
2024-12-07 21:50:27,645 - services.marketplaces.base - ERROR - API error: No search criteria
2024-12-07 21:50:27,646 - services.marketplaces.base - ERROR - Request error: Request error: No search criteria
2024-12-07 21:50:27,646 - services.marketplaces.base - ERROR - Validation error: Request error: No search criteria
2024-12-07 21:53:10,863 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 21:53:30,910 - services.marketplaces.base - ERROR - Unexpected response type: text/plain; charset=utf-8, body: 404 page not found

2024-12-07 21:53:30,910 - services.marketplaces.base - ERROR - Validation error: Invalid API key or Client ID
2024-12-07 21:53:44,360 - services.marketplaces.base - ERROR - Unexpected response type: application/problem+json, body: {
    "title": "path not found",
    "detail": "Please consult the https://openapi.wildberries.ru",
    "code": "9995b4770d66c-f3e1c2a5 100383f3cea0510517f9c548ba59a5a0",
    "requestId": "100383f3cea0510517f9c548ba59a5a0",
    "origin": "s2s-api-auth-dp-sandbox",
    "status": 404,
    "statusText": "Not Found",
    "timestamp": "2024-12-07T18:53:43Z"
}

2024-12-07 21:53:44,360 - services.marketplaces.base - ERROR - Validation error: Invalid API key or Client ID
2024-12-07 21:53:44,361 - bot.handlers.user - ERROR - Error processing Wildberries API key: Invalid API key or Client ID
2024-12-07 22:03:14,225 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 22:03:39,071 - services.marketplaces.base - ERROR - Validation error: Invalid API endpoint or Client ID
2024-12-07 22:07:23,783 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 22:17:49,519 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 22:30:39,150 - __main__ - ERROR - Error in main function: name 'register_all_handlers' is not defined
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/main.py", line 65, in main
    register_all_handlers(dp, config, dp["db"])
    ^^^^^^^^^^^^^^^^^^^^^
NameError: name 'register_all_handlers' is not defined
2024-12-07 22:31:45,650 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 22:31:58,012 - bot.middlewares.error - ERROR - Error processing event from user 1879978399: format_subscription_status() missing 2 required positional arguments: 'end_date' and 'check_interval'
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/middlewares/error.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/handlers/user.py", line 418, in show_subscription
    status_text = await format_subscription_status(user_data)
                        ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
TypeError: format_subscription_status() missing 2 required positional arguments: 'end_date' and 'check_interval'
2024-12-07 22:31:58,485 - bot.middlewares.error - ERROR - Failed to notify admin about error: 'config'
2024-12-07 22:32:13,236 - bot.middlewares.error - ERROR - Error processing event from user 1879978399: format_subscription_status() missing 2 required positional arguments: 'end_date' and 'check_interval'
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/middlewares/error.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/handlers/user.py", line 418, in show_subscription
    status_text = await format_subscription_status(user_data)
                        ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
TypeError: format_subscription_status() missing 2 required positional arguments: 'end_date' and 'check_interval'
2024-12-07 22:32:13,395 - bot.middlewares.error - ERROR - Failed to notify admin about error: 'config'
2024-12-07 22:33:27,361 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 22:36:15,778 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 22:36:27,335 - bot.middlewares.error - ERROR - Error processing event from user 1879978399: 'Config' object has no attribute 'payment_provider_token'
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/middlewares/error.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/handlers/payment.py", line 62, in process_plan_selection
    provider_token=settings.payment_provider_token,
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Config' object has no attribute 'payment_provider_token'
2024-12-07 22:36:27,498 - bot.middlewares.error - ERROR - Failed to notify admin about error: 'config'
2024-12-07 22:38:10,904 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-07 22:42:18,952 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-08 09:30:57,153 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-08 09:32:59,728 - bot.middlewares.error - ERROR - Error processing event from user 1879978399: format_subscription_status() got an unexpected keyword argument 'status'
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/middlewares/error.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/handlers/user.py", line 127, in cmd_status
    format_subscription_status(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^
        status=user_data["subscription_status"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        end_date=user_data["subscription_end_date"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        check_interval=user_data["check_interval"]
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ),
    ^
TypeError: format_subscription_status() got an unexpected keyword argument 'status'
2024-12-08 09:32:59,880 - bot.middlewares.error - ERROR - Failed to notify admin about error: 'config'
2024-12-08 09:38:35,634 - __main__ - ERROR - Error in main function: Passing `parse_mode`, `disable_web_page_preview` or `protect_content` to Bot initializer is not supported anymore. These arguments have been removed in 3.7.0 version. Use `default=DefaultBotProperties(parse_mode=<ParseMode.MARKDOWN: 'Markdown'>)` argument instead.
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/main.py", line 48, in main
    bot = Bot(token=config.telegram.token, parse_mode=ParseMode.MARKDOWN)
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/client/bot.py", line 310, in __init__
    raise TypeError(
    ...<3 lines>...
    )
TypeError: Passing `parse_mode`, `disable_web_page_preview` or `protect_content` to Bot initializer is not supported anymore. These arguments have been removed in 3.7.0 version. Use `default=DefaultBotProperties(parse_mode=<ParseMode.MARKDOWN: 'Markdown'>)` argument instead.
2024-12-08 09:39:20,595 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-08 09:39:21,158 - bot.middlewares.error - ERROR - Error processing event from user 1879978399: name 'InlineKeyboardBuilder' is not defined
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/middlewares/error.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/handlers/user.py", line 439, in cmd_menu
    reply_markup=get_main_menu_keyboard()
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/keyboards/user.py", line 113, in get_main_menu_keyboard
    builder = InlineKeyboardBuilder()
              ^^^^^^^^^^^^^^^^^^^^^
NameError: name 'InlineKeyboardBuilder' is not defined. Did you mean: 'InlineKeyboardButton'?
2024-12-08 09:39:21,610 - bot.middlewares.error - ERROR - Failed to notify admin about error: 'config'
2024-12-08 09:46:59,477 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-08 09:47:15,821 - bot.middlewares.error - ERROR - Error processing event from user 1879978399: name 'InlineKeyboardBuilder' is not defined
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/middlewares/error.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/handlers/user.py", line 453, in cmd_menu
    reply_markup=get_main_menu_keyboard()
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/keyboards/user.py", line 113, in get_main_menu_keyboard
    builder = InlineKeyboardBuilder()
              ^^^^^^^^^^^^^^^^^^^^^
NameError: name 'InlineKeyboardBuilder' is not defined. Did you mean: 'InlineKeyboardButton'?
2024-12-08 09:47:15,995 - bot.middlewares.error - ERROR - Failed to notify admin about error: 'config'
2024-12-08 09:55:03,846 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-08 09:58:25,522 - bot.middlewares.error - ERROR - Error processing event from user 1879978399: format_subscription_status() got an unexpected keyword argument 'status'
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/middlewares/error.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/handlers/user.py", line 141, in cmd_status
    format_subscription_status(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^
        status=user_data["subscription_status"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        end_date=user_data["subscription_end_date"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        check_interval=user_data["check_interval"]
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ),
    ^
TypeError: format_subscription_status() got an unexpected keyword argument 'status'
2024-12-08 09:58:25,649 - bot.middlewares.error - ERROR - Failed to notify admin about error: 'config'
2024-12-08 10:00:32,864 - services.monitoring.monitor - ERROR - Error in monitoring loop: 'Database' object has no attribute 'get_active_subscriptions'
2024-12-08 10:00:40,403 - bot.middlewares.error - ERROR - Error processing event from user 1879978399: 1 validation error for SendMessage
text
  Input should be a valid string [type=string_type, input_value=<coroutine object format_...n_status at 0x10d874c20>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.9/v/string_type
Traceback (most recent call last):
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/middlewares/error.py", line 21, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/kagitin/CascadeProjects/priceguard/src/bot/handlers/user.py", line 140, in cmd_status
    await message.answer(
          ~~~~~~~~~~~~~~^
        format_subscription_status(user_data),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        reply_markup=get_subscription_keyboard()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/aiogram/types/message.py", line 2091, in answer
    return SendMessage(
           ~~~~~~~~~~~^
        chat_id=self.chat.id,
        ^^^^^^^^^^^^^^^^^^^^^
    ...<15 lines>...
        **kwargs,
        ^^^^^^^^^
    ).as_(self._bot)
    ^
  File "/Users/kagitin/CascadeProjects/priceguard/venv/lib/python3.13/site-packages/pydantic/main.py", line 212, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for SendMessage
text
  Input should be a valid string [type=string_type, input_value=<coroutine object format_...n_status at 0x10d874c20>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.9/v/string_type
2024-12-08 10:00:40,536 - bot.middlewares.error - ERROR - Failed to notify admin about error: 'config'
