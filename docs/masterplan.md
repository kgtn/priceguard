# Masterplan for Telegram Bot

## 1. App Overview and Objectives
Бот предназначен для продавцов на Ozon и Wildberries, чтобы оперативно отслеживать, какие товары автоматически участвуют в акциях. Это помогает пользователям быть в курсе изменений и своевременно реагировать на них.

---

## 2. Target Audience
Продавцы, размещающие товары на маркетплейсах Ozon и Wildberries, которым важно получать уведомления об участии товаров в автоакциях.

---

## 3. Core Features and Functionality
### 1. Регистрация и личный кабинет
- Регистрация через Telegram.
- Возможность восстановления доступа через email.

### 2. Подписка
- Оплата подписки 400 рублей/месяц через Telegram Payments + ЮKassa.
- Тестовый период 14 дней.

### 3. API-ключи
- Добавление API-ключей Ozon и Wildberries.
- Проверка корректности ключей.
- Шифрование ключей.

### 4. Мониторинг акций
- **Первичная проверка:**
  - Сохранение базового количества товаров в акциях.
- **Периодическая проверка:**
  - Опции: 1 час, 2 часа, 4 часа, 13 часов, 1 раз в сутки.
  - Сравнение текущего и базового значения.
  - Уведомления в Telegram с детализацией изменений.

### 5. Подписка и уведомления
- Автосписание оплаты.
- Уведомление о завершении подписки и кнопки для продления/отмены подписки, удаления данных.

---

## 4. Functional Roles
### 4.1 Клиент
#### Основные команды:
- **`/start`**:
  - Приветственное сообщение с объяснением функционала бота.
  - Инструкция по регистрации, добавлению API-ключей и настройке подписки.
- **`/help`**:
  - Справка о командах:
	- `/start`: начать работу с ботом.
	- `/add_api`: добавить API-ключи.
	- `/status`: проверить статус подписки.
	- `/settings`: изменить частоту проверок.
	- `/unsubscribe`: отменить подписку.
	- `/delete_data`: удалить свои данные.
- **`/add_api`**:
  - Диалог для добавления ключей Ozon и Wildberries:
	1. Запрос ключа Ozon:
	   - "Введите ваш API-ключ для Ozon."
	   - Проверка ключа на валидность.
	2. Запрос ключа Wildberries:
	   - "Введите ваш API-ключ для Wildberries."
	   - Проверка ключа на валидность.
  - Сообщение об успешном добавлении: "Ключи успешно сохранены!"
- **`/status`**:
  - Проверка статуса подписки:
	- "Ваша подписка активна до [дата]. Частота проверок: [выбранный интервал]."
- **`/settings`**:
  - Изменение частоты проверок:
	- Кнопки с вариантами: "1 час", "2 часа", "4 часа", "13 часов", "1 раз в сутки".
	- Подтверждение: "Частота проверок изменена на [выбранный интервал]."
- **`/unsubscribe`**:
  - Отмена подписки:
	- Уточняющий вопрос: "Вы уверены, что хотите отменить подписку? Это действие нельзя отменить."
	- Кнопки: "Да, отменить" / "Нет".
	- Уведомление об отмене.
- **`/delete_data`**:
  - Удаление всех данных:
	- "Вы уверены, что хотите удалить свои данные? Это действие необратимо."
	- Кнопки: "Да, удалить" / "Нет".
	- Уведомление об успешном удалении.

#### Пример уведомления:
- "Изменение количества товаров в автоакциях:
  - Ozon: было 10, стало 15.
  - Wildberries: было 8, стало 5."

---

### 4.2 Суперадмин
#### Основные возможности:
- **Управление пользователями:**
  - Просмотр активных пользователей.
  - Удаление пользователя.
- **Управление подписками:**
  - Просмотр подписок.
  - Принудительное продление или отмена подписки.
- **Управление проверками:**
  - Настройка глобальной периодичности проверок.
  - Принудительный запуск проверки для всех пользователей.
- **Мониторинг бота:**
  - Просмотр статистики:
	- Количество активных пользователей.
	- Количество активных подписок.
	- Количество выполненных проверок.
  - Просмотр логов ошибок.
- **Команды для суперадмина:**
  - **`/admin`**: меню с возможностями суперадмина.
  - **`/users`**: список активных пользователей.
  - **`/subscriptions`**: управление подписками.
  - **`/logs`**: просмотр логов.
  - **`/broadcast`**: отправка массовых уведомлений (например, о технических работах).
  - **`/force_check`**: запуск проверки вручную.

---

## 5. High-Level Technical Stack Recommendations
- **Язык разработки:** Python
- **Фреймворк:** Aiogram (оптимально для Telegram-ботов)
- **База данных:** SQLite (легкость настройки, подходит для хранения временных данных).
- **Шифрование:** Использование библиотеки `cryptography` для безопасного хранения API-ключей.
- **Платежная система:** Telegram Payments через ЮKassa.
- **Хостинг:** VPS или облачный сервер для стабильной работы (например, Heroku, AWS, или DigitalOcean).

---

## 6. Conceptual Data Model
### Таблица пользователей:
- `user_id` (PK, Telegram ID)
- `email`
- `ozon_api_key` (зашифрованный)
- `wildberries_api_key` (зашифрованный)
- `subscription_status` (active/inactive)
- `subscription_end_date`

### Таблица акций:
- `user_id` (FK)
- `marketplace` (Ozon/Wildberries)
- `base_count` (начальное количество товаров)
- `last_checked_count` (последнее количество товаров)
- `last_checked_date`

---

## 7. Development Phases
1. **Проектирование:**
   - Определение структуры базы данных.
   - Настройка доступа к API Ozon и Wildberries.

2. **Разработка MVP:**
   - Регистрация, добавление API-ключей, первичная проверка акций.
   - Уведомления через Telegram.

3. **Интеграция платежей:**
   - Внедрение системы подписок и тестового периода.

4. **Оптимизация и тестирование:**
   - Нагрузочное тестирование на сотни пользователей.
   - Тестирование уведомлений и автосписаний.

5. **Развёртывание:**
   - Хостинг и настройка мониторинга.

---
